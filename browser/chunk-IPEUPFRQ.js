import{d as N,h as ne}from"./chunk-KHKHKSS3.js";import{F as T,J as D,M as I,O as R,P as A,S as U,Y as L,Z as W,aa as j,ca as Z,ea as B,fa as q,ga as z,ha as G,ia as Y,ja as H,qa as J,ra as K,sa as Q,ta as X,ua as $}from"./chunk-VLMZZGMH.js";import{$a as o,$b as F,Ea as l,Ia as d,Lb as ie,Ma as E,Qa as f,Sb as O,Ta as P,Wb as k,Za as p,_a as n,c as te,db as w,eb as _,f as C,fa as m,fb as h,ga as c,jb as b,lb as g,mb as V,nb as M,pb as v,qb as x,rb as y,zb as S}from"./chunk-NODDN4TF.js";function re(i,r){i&1&&(n(0,"h2"),g(1,"Iniciar sesi\xF3n"),o())}function oe(i,r){i&1&&(n(0,"h2"),g(1,"Crear cuenta"),o())}function ae(i,r){if(i&1&&(n(0,"p",12),g(1),o()),i&2){let e=h();l(),V(e.infoMsg)}}function se(i,r){if(i&1){let e=w();n(0,"button",15),_("click",function(){m(e);let a=h(2);return c(a.resendVerification())}),g(1," Reenviar correo "),o()}}function le(i,r){if(i&1&&(n(0,"p",13),g(1),f(2,se,2,0,"button",14),o()),i&2){let e=h();l(),M(" ",e.errorMsg," "),l(),p("ngIf",e.errorMsg.includes("verificado"))}}var ee,ge=te(()=>{F();$();A();Z();ie();A();Z();ne();F();$();ee=class i{constructor(r,e,t,a){this.auth=r;this.fs=e;this.router=t;this.ngZone=a}email="";password="";isLogin=!0;errorMsg="";infoMsg="";toggleMode(){this.errorMsg="",this.infoMsg="",this.isLogin=!this.isLogin}submit(r){return C(this,null,function*(){if(this.errorMsg="",this.infoMsg="",r.invalid){this.errorMsg="Por favor completa todos los campos.";return}try{if(this.isLogin){let e=yield R(this.auth,this.email,this.password);if(!e.user.emailVerified){this.errorMsg="\u274C Tu correo no est\xE1 verificado. Revisa tu bandeja.";return}let t=L(this.fs,"users",e.user.uid),a=yield W(t);if(!a.exists()){this.errorMsg="\u274C Usuario sin perfil en Firestore.";return}a.data().role==="admin"?this.ngZone.run(()=>this.router.navigate(["/admin"])):this.ngZone.run(()=>this.router.navigate(["/cliente"]))}else{let e=yield D(this.auth,this.email,this.password);yield I(e.user,{url:window.location.origin+"/login"});let t={email:e.user.email,role:"customer",createdAt:Date.now()};yield j(L(this.fs,"users",e.user.uid),t),this.infoMsg="\u2705 Te enviamos un correo de verificaci\xF3n. \xC1brelo (rev\xEDsate spam) y luego vuelve a iniciar sesi\xF3n.",this.isLogin=!0}}catch(e){this.errorMsg=e.code?e.code.replace("auth/","").replace(/-/g," "):e.message||"Error inesperado"}})}resendVerification(){return C(this,null,function*(){this.errorMsg="",this.infoMsg="";let r=this.auth.currentUser;r&&!r.emailVerified?(yield I(r,{url:window.location.origin+"/login"}),this.infoMsg="\u2705 Reenviamos el correo de verificaci\xF3n."):this.errorMsg="\u26A0\uFE0F No hay usuario pendiente de verificaci\xF3n."})}static \u0275fac=function(e){return new(e||i)(d(T),d(U),d(N),d(P))};static \u0275cmp=E({type:i,selectors:[["app-login"]],decls:19,vars:8,consts:[["regTitle",""],["f","ngForm"],[1,"login-panel"],[4,"ngIf","ngIfElse"],[1,"registro-link"],["href","#",3,"click"],[3,"ngSubmit"],["type","email","name","email","placeholder","ejemplo@gmail.com","required","","email","",3,"ngModelChange","ngModel"],["type","password","name","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","required","","minlength","6",3,"ngModelChange","ngModel"],["type","submit",1,"btn-ingresar"],["class","info-msg",4,"ngIf"],["class","error-msg",4,"ngIf"],[1,"info-msg"],[1,"error-msg"],["class","btn-reenviar",3,"click",4,"ngIf"],[1,"btn-reenviar",3,"click"]],template:function(e,t){if(e&1){let a=w();n(0,"section",2),f(1,re,2,0,"h2",3)(2,oe,2,0,"ng-template",null,0,S),n(4,"p",4)(5,"a",5),_("click",function(s){return m(a),t.toggleMode(),c(s.preventDefault())}),g(6),o()(),n(7,"form",6,1),_("ngSubmit",function(){m(a);let s=b(8);return c(t.submit(s))}),n(9,"label"),g(10,"Email"),o(),n(11,"input",7),y("ngModelChange",function(s){return m(a),x(t.email,s)||(t.email=s),c(s)}),o(),n(12,"label"),g(13,"Contrase\xF1a"),o(),n(14,"input",8),y("ngModelChange",function(s){return m(a),x(t.password,s)||(t.password=s),c(s)}),o(),n(15,"button",9),g(16),o()(),f(17,ae,2,1,"p",10)(18,le,3,2,"p",11),o()}if(e&2){let a=b(3);l(),p("ngIf",t.isLogin)("ngIfElse",a),l(5),M(" ",t.isLogin?"\xBFEres nuevo? Reg\xEDstrate":"\xBFYa tienes cuenta? Inicia sesi\xF3n"," "),l(5),v("ngModel",t.email),l(3),v("ngModel",t.password),l(2),M(" ",t.isLogin?"Iniciar sesi\xF3n":"Registrarme"," "),l(),p("ngIf",t.infoMsg),l(),p("ngIf",t.errorMsg)}},dependencies:[k,O,X,H,B,q,z,J,Q,K,Y,G],styles:[".login-panel[_ngcontent-%COMP%]{max-width:380px;margin:4rem auto;padding:2.5rem;background:#fff;border-radius:8px;box-shadow:0 4px 12px #00000014;font-family:Segoe UI,sans-serif;color:#333}.login-panel[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:.6rem;font-size:1.6rem}.registro-link[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem;font-size:.95rem}.registro-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2e7d32;text-decoration:none;font-weight:500}form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;margin:1rem 0 .3rem;color:#444}form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:1rem;border:1px solid #bbb;border-radius:6px;transition:border .2s}form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#2e7d32;outline:none}.btn-ingresar[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;background:#2e7d32;color:#fff;font-weight:600;padding:12px;border:none;border-radius:6px;cursor:pointer;transition:background .3s,transform .2s}.btn-ingresar[_ngcontent-%COMP%]:hover{background:#1b5e20;transform:scale(1.02)}.info-msg[_ngcontent-%COMP%]{margin-top:1rem;color:#2e7d32;text-align:center}.error-msg[_ngcontent-%COMP%]{margin-top:1rem;color:#c62828;text-align:center}.btn-reenviar[_ngcontent-%COMP%]{background:none;border:none;color:#1565c0;text-decoration:underline;cursor:pointer;margin-left:.5rem}"]})}});ge();export{ee as LoginComponent};
