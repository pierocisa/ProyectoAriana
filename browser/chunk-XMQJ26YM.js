import{F as W,N as j,P as tt,S as B,U as L,W as R,Y as M,ba as E,ca as et,ea as q,fa as G,ia as H,la as $,ma as J,na as K,ta as Q,ua as X}from"./chunk-VLMZZGMH.js";import{$a as n,$b as A,Ea as c,Lb as v,Ma as U,Qa as f,Rb as F,Sb as T,Ub as z,Wb as N,X as S,Za as g,_a as i,a as P,aa as _,c as y,db as b,eb as p,fa as d,fb as u,ga as m,kb as k,lb as o,mb as O,nb as I,pb as h,qb as C,rb as x,ub as D,vb as V}from"./chunk-NODDN4TF.js";var w,Y=y(()=>{"use strict";v();et();tt();v();w=class s{firestore=_(B);auth=_(W);coleccion="users";obtenerUsuarios(){let e=R(this.firestore,this.coleccion);return L(e,{idField:"id"})}actualizarUsuario(e,t){let r=M(this.firestore,`${this.coleccion}/${e}`);return E(r,t)}actualizarRol(e,t){let r=M(this.firestore,`${this.coleccion}/${e}`);return E(r,{role:t})}actualizarEstado(e,t){let r=M(this.firestore,`${this.coleccion}/${e}`);return E(r,{estado:t})}resetearPassword(e){return j(this.auth,e)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=S({token:s,factory:s.\u0275fac,providedIn:"root"})}});function nt(s,e){if(s&1){let t=b();i(0,"button",10),p("click",function(){d(t);let a=u().$implicit,l=u();return m(l.habilitarUsuario(a))}),o(1," \u2705 Habilitar "),n()}}function ot(s,e){if(s&1){let t=b();i(0,"button",11),p("click",function(){d(t);let a=u().$implicit,l=u();return m(l.deshabilitarUsuario(a))}),o(1," \u{1F6AB} Deshabilitar "),n()}}function rt(s,e){if(s&1){let t=b();i(0,"tr")(1,"td"),o(2),n(),i(3,"td"),o(4),D(5,"uppercase"),n(),i(6,"td")(7,"span"),o(8),n()(),i(9,"td")(10,"button",7),p("click",function(){let a=d(t).index,l=u();return m(l.abrirModal(a))}),o(11,"\u270F\uFE0F Editar"),n(),f(12,nt,2,0,"button",8)(13,ot,2,0,"button",9),n()()}if(s&2){let t=e.$implicit;c(2),O(t.email),c(2),O(V(5,9,t.role)),c(3),k("activo",t.estado==="activo")("inactivo",t.estado==="inactivo"),c(),I(" \u25CF ",t.estado==="activo"?"Activo":"Inactivo"," "),c(4),g("ngIf",t.estado==="inactivo"),c(),g("ngIf",t.estado==="activo")}}function at(s,e){s&1&&(i(0,"div",12),o(1," \u{1F4ED} No hay usuarios registrados. "),n())}function st(s,e){s&1&&(i(0,"div",13),o(1," \u23F3 Cargando usuarios... "),n())}function lt(s,e){if(s&1){let t=b();i(0,"div",14)(1,"div",15)(2,"h3"),o(3,"\u270F\uFE0F Editar Usuario"),n(),i(4,"label"),o(5,"Email (no editable):"),n(),i(6,"input",16),x("ngModelChange",function(a){d(t);let l=u();return C(l.usuarioEditando.email,a)||(l.usuarioEditando.email=a),m(a)}),n(),i(7,"label"),o(8,"Rol:"),n(),i(9,"select",17),x("ngModelChange",function(a){d(t);let l=u();return C(l.usuarioEditando.role,a)||(l.usuarioEditando.role=a),m(a)}),i(10,"option",18),o(11,"CUSTOMER"),n(),i(12,"option",19),o(13,"ADMIN"),n()(),i(14,"label"),o(15,"Estado:"),n(),i(16,"select",17),x("ngModelChange",function(a){d(t);let l=u();return C(l.usuarioEditando.estado,a)||(l.usuarioEditando.estado=a),m(a)}),i(17,"option",20),o(18,"Activo"),n(),i(19,"option",21),o(20,"Inactivo"),n()(),i(21,"div",22)(22,"button",23),p("click",function(){d(t);let a=u();return m(a.guardarCambiosUsuario())}),o(23,"\u{1F4BE} Guardar"),n(),i(24,"button",24),p("click",function(){d(t);let a=u();return m(a.cerrarModal())}),o(25,"\u274C Cancelar"),n()()()()}if(s&2){let t=u();c(6),h("ngModel",t.usuarioEditando.email),c(3),h("ngModel",t.usuarioEditando.role),c(7),h("ngModel",t.usuarioEditando.estado)}}var Z,ct=y(()=>{v();A();X();Y();v();A();X();Z=class s{cargando=!1;usuarios=[];filtroEmail="";modalActivo=!1;editandoId=null;usuarioEditando=this.obtenerUsuarioVacio();usuarioService=_(w);ngOnInit(){this.cargarUsuarios()}get usuariosFiltrados(){return this.usuarios.filter(e=>e.email.toLowerCase().includes(this.filtroEmail.toLowerCase()))}cargarUsuarios(){this.cargando=!0,this.usuarioService.obtenerUsuarios().subscribe({next:e=>{console.log("\u{1F4E5} Usuarios obtenidos:",e),this.usuarios=e,this.cargando=!1},error:e=>{console.error("\u274C Error al obtener usuarios:",e),alert("\u26A0\uFE0F No se pudieron cargar los usuarios."),this.cargando=!1}})}abrirModal(e){e!==void 0?(this.editandoId=e,this.usuarioEditando=P({},this.usuarios[e])):(this.editandoId=null,this.usuarioEditando=this.obtenerUsuarioVacio()),this.modalActivo=!0}cerrarModal(){this.modalActivo=!1,this.editandoId=null}guardarCambiosUsuario(){if(!this.usuarioEditando.id){alert("\u26A0\uFE0F No se puede actualizar un usuario sin ID.");return}this.usuarioService.actualizarUsuario(this.usuarioEditando.id,{role:this.usuarioEditando.role,estado:this.usuarioEditando.estado}).then(()=>{alert("\u2705 Usuario actualizado correctamente."),this.cerrarModal(),this.cargarUsuarios()}).catch(e=>{console.error("\u274C Error al actualizar usuario:",e),alert("\u26A0\uFE0F No se pudo actualizar el usuario.")})}habilitarUsuario(e){this.usuarioService.actualizarEstado(e.id,"activo").then(()=>this.cargarUsuarios()).catch(t=>console.error("\u274C Error al habilitar usuario:",t))}deshabilitarUsuario(e){this.usuarioService.actualizarEstado(e.id,"inactivo").then(()=>this.cargarUsuarios()).catch(t=>console.error("\u274C Error al deshabilitar usuario:",t))}obtenerUsuarioVacio(){return{email:"",role:"customer",estado:"activo"}}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=U({type:s,selectors:[["app-usuarios"]],decls:20,vars:5,consts:[[1,"usuarios-panel"],["type","text","placeholder","\u{1F50D} Buscar usuarios por email...",1,"input-busqueda",3,"ngModelChange","ngModel"],[1,"tabla-usuarios"],[4,"ngFor","ngForOf"],["class","mensaje-vacio",4,"ngIf"],["class","spinner",4,"ngIf"],["class","modal-bg",4,"ngIf"],[1,"btn-editar",3,"click"],["class","btn-habilitar",3,"click",4,"ngIf"],["class","btn-deshabilitar",3,"click",4,"ngIf"],[1,"btn-habilitar",3,"click"],[1,"btn-deshabilitar",3,"click"],[1,"mensaje-vacio"],[1,"spinner"],[1,"modal-bg"],[1,"modal"],["type","email","disabled","",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value","customer"],["value","admin"],["value","activo"],["value","inactivo"],[1,"acciones-modal"],[1,"btn-guardar",3,"click"],[1,"btn-cancelar",3,"click"]],template:function(t,r){t&1&&(i(0,"section",0)(1,"h2"),o(2,"\u{1F465} Gesti\xF3n de Usuarios"),n(),i(3,"input",1),x("ngModelChange",function(l){return C(r.filtroEmail,l)||(r.filtroEmail=l),l}),n(),i(4,"table",2)(5,"thead")(6,"tr")(7,"th"),o(8,"Email"),n(),i(9,"th"),o(10,"Rol"),n(),i(11,"th"),o(12,"Estado"),n(),i(13,"th"),o(14,"Acciones"),n()()(),i(15,"tbody"),f(16,rt,14,11,"tr",3),n()(),f(17,at,2,0,"div",4)(18,st,2,0,"div",5),n(),f(19,lt,26,3,"div",6)),t&2&&(c(3),h("ngModel",r.filtroEmail),c(13),g("ngForOf",r.usuariosFiltrados),c(),g("ngIf",!r.cargando&&r.usuariosFiltrados.length===0),c(),g("ngIf",r.cargando),c(),g("ngIf",r.modalActivo))},dependencies:[N,F,T,z,Q,J,K,q,$,G,H],styles:[".usuarios-panel[_ngcontent-%COMP%]{padding:2rem;background-color:#f9f9f9;border-radius:16px;box-shadow:0 4px 12px #00000014;font-family:Segoe UI,sans-serif}.usuarios-panel[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}.input-busqueda[_ngcontent-%COMP%]{padding:.5rem 1rem;margin-bottom:1rem;width:100%;max-width:400px;border:1px solid #ccc;border-radius:8px;font-size:1rem}.tabla-usuarios[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background-color:#fff;border-radius:12px;overflow:hidden}.tabla-usuarios[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabla-usuarios[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;text-align:left;border-bottom:1px solid #eee}.tabla-usuarios[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f0f0f0;font-weight:700}.tabla-usuarios[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}.activo[_ngcontent-%COMP%]{color:green}.inactivo[_ngcontent-%COMP%]{color:red}button[_ngcontent-%COMP%]{border:none;padding:.4rem .8rem;border-radius:6px;font-size:.9rem;cursor:pointer;transition:background-color .3s ease}.btn-editar[_ngcontent-%COMP%]{background-color:#1976d2;color:#fff}.btn-editar[_ngcontent-%COMP%]:hover{background-color:#125ea2}.btn-habilitar[_ngcontent-%COMP%]{background-color:#43a047;color:#fff}.btn-habilitar[_ngcontent-%COMP%]:hover{background-color:#388e3c}.btn-deshabilitar[_ngcontent-%COMP%]{background-color:#e53935;color:#fff}.btn-deshabilitar[_ngcontent-%COMP%]:hover{background-color:#c62828}.mensaje-vacio[_ngcontent-%COMP%]{margin-top:1rem;color:#999;font-style:italic}.spinner[_ngcontent-%COMP%]{margin-top:1rem;font-weight:700;color:#555}.modal-bg[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:16px;width:90%;max-width:400px;box-shadow:0 6px 18px #00000026}.modal[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:1.5rem}.modal[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-top:1rem;font-weight:700}.modal[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .modal[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:.5rem;margin-top:.25rem;border-radius:8px;border:1px solid #ccc}.acciones-modal[_ngcontent-%COMP%]{margin-top:1.5rem;display:flex;justify-content:flex-end;gap:.5rem}.btn-guardar[_ngcontent-%COMP%]{background-color:#2e7d32;color:#fff}.btn-guardar[_ngcontent-%COMP%]:hover{background-color:#1b5e20}.btn-cancelar[_ngcontent-%COMP%]{background-color:#757575;color:#fff}.btn-cancelar[_ngcontent-%COMP%]:hover{background-color:#616161}"]})}});ct();export{Z as UsuariosComponent};
