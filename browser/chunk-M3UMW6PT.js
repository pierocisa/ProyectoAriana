import{a as z,b as Z}from"./chunk-WRZN5SWP.js";import{ea as B,fa as L,ia as q,ka as j,la as R,ma as U,na as G,pa as H,qa as J,ta as K,ua as Q}from"./chunk-VLMZZGMH.js";import{$a as e,$b as A,Ca as S,Ea as c,Ib as I,Lb as V,Ma as k,Qa as _,Rb as F,Sb as T,Tb as N,Wb as W,Za as p,_a as o,a as v,aa as E,ab as w,b as y,c as Y,db as P,eb as g,f as M,fa as u,fb as s,ga as m,lb as r,mb as b,nb as C,pb as f,qb as h,rb as x,ub as O,vb as D}from"./chunk-NODDN4TF.js";function $(d,n){if(d&1){let t=P();o(0,"label",9)(1,"input",10),g("change",function(){let i=u(t).$implicit,a=s();return m(a.toggleCategoria(i))}),e(),r(2),O(3,"titlecase"),e()}if(d&2){let t=n.$implicit,l=s();c(),p("checked",l.categoriasSeleccionadas.includes(t)),c(),C(" ",D(3,2,t)," ")}}function tt(d,n){d&1&&(o(0,"div",11),r(1," \u23F3 Cargando productos... "),e())}function et(d,n){d&1&&(o(0,"div",12),r(1," \u{1F4ED} No hay productos registrados para esta categor\xEDa. "),e())}function ot(d,n){if(d&1){let t=P();o(0,"button",22),g("click",function(){u(t);let i=s().$implicit,a=s(2);return m(a.inhabilitar(i))}),r(1," \u{1F6AB} "),e()}}function nt(d,n){if(d&1){let t=P();o(0,"button",23),g("click",function(){u(t);let i=s().$implicit,a=s(2);return m(a.activar(i))}),r(1," \u2705 "),e()}}function it(d,n){if(d&1){let t=P();o(0,"tr")(1,"td"),r(2),e(),o(3,"td"),r(4),e(),o(5,"td"),r(6),e(),o(7,"td"),r(8),e(),o(9,"td")(10,"div")(11,"strong"),r(12),e(),r(13," unidades "),e(),o(14,"div",15)(15,"input",16),x("ngModelChange",function(i){let a=u(t).$implicit;return h(a.cantidadExtra,i)||(a.cantidadExtra=i),m(i)}),e(),o(16,"button",17),g("click",function(){let i=u(t).$implicit,a=s(2);return m(a.aumentarStock(i))}),r(17," \u{1F504} "),e()()(),o(18,"td"),w(19,"img",18),e(),o(20,"td"),r(21),e(),o(22,"td")(23,"button",19),g("click",function(){let i=u(t).$implicit,a=s(2);return m(a.abrirModal(i))}),r(24," \u270F\uFE0F "),e(),_(25,ot,2,0,"button",20)(26,nt,2,0,"button",21),e()()}if(d&2){let t=n.$implicit;c(2),b(t.categoria),c(2),b(t.nombre),c(2),b(t.descripcion),c(2),C("S/. ",t.precio),c(4),b(t.stock),c(3),f("ngModel",t.cantidadExtra),c(4),p("src",t.imagen,S),c(2),C(" ",t.estado==="activo"?"\u2705 Activo":"\u{1F6AB} Inactivo"," "),c(4),p("ngIf",t.estado==="activo"),c(),p("ngIf",t.estado==="inactivo")}}function rt(d,n){if(d&1&&(o(0,"table",13)(1,"thead")(2,"tr")(3,"th"),r(4,"Categor\xEDa"),e(),o(5,"th"),r(6,"Nombre"),e(),o(7,"th"),r(8,"Descripci\xF3n"),e(),o(9,"th"),r(10,"Precio"),e(),o(11,"th"),r(12,"Stock"),e(),o(13,"th"),r(14,"Imagen"),e(),o(15,"th"),r(16,"Estado"),e(),o(17,"th"),r(18,"Acciones"),e()()(),o(19,"tbody"),_(20,it,27,10,"tr",14),e()()),d&2){let t=s();c(20),p("ngForOf",t.productosFiltrados)}}function at(d,n){if(d&1&&(o(0,"option",44),r(1),e()),d&2){let t=n.$implicit;p("value",t),c(),b(t)}}function ct(d,n){if(d&1&&(o(0,"div",45),w(1,"img",46),e()),d&2){let t=s(2);c(),p("src",t.nuevoProducto.imagen,S)}}function dt(d,n){if(d&1){let t=P();o(0,"div",24)(1,"div",25)(2,"h3"),r(3),e(),o(4,"label",26),r(5,"Categor\xEDa:"),e(),o(6,"select",27),x("ngModelChange",function(i){u(t);let a=s();return h(a.nuevoProducto.categoria,i)||(a.nuevoProducto.categoria=i),m(i)}),o(7,"option",28),r(8,"Seleccione una categor\xEDa"),e(),_(9,at,2,2,"option",29),e(),o(10,"label",30),r(11,"Nombre:"),e(),o(12,"input",31),x("ngModelChange",function(i){u(t);let a=s();return h(a.nuevoProducto.nombre,i)||(a.nuevoProducto.nombre=i),m(i)}),e(),o(13,"label",32),r(14,"Descripci\xF3n:"),e(),o(15,"textarea",33),x("ngModelChange",function(i){u(t);let a=s();return h(a.nuevoProducto.descripcion,i)||(a.nuevoProducto.descripcion=i),m(i)}),e(),o(16,"label",34),r(17,"Precio:"),e(),o(18,"input",35),x("ngModelChange",function(i){u(t);let a=s();return h(a.nuevoProducto.precio,i)||(a.nuevoProducto.precio=i),m(i)}),e(),o(19,"label",36),r(20,"Stock inicial:"),e(),o(21,"input",37),x("ngModelChange",function(i){u(t);let a=s();return h(a.nuevoProducto.stock,i)||(a.nuevoProducto.stock=i),m(i)}),e(),o(22,"label",38),r(23,"Imagen:"),e(),o(24,"input",39),g("change",function(i){u(t);let a=s();return m(a.cargarImagen(i))}),e(),_(25,ct,2,1,"div",40),o(26,"div",41)(27,"button",42),g("click",function(){u(t);let i=s();return m(i.guardarProducto())}),r(28,"\u{1F4BE} Guardar"),e(),o(29,"button",43),g("click",function(){u(t);let i=s();return m(i.cerrarModal())}),r(30,"\u274C Cancelar"),e()()()()}if(d&2){let t=s();c(3),b(t.editandoId?"\u270F\uFE0F Editar Producto":"\u2795 Nuevo Producto"),c(3),f("ngModel",t.nuevoProducto.categoria),c(3),p("ngForOf",t.categoriasDisponibles),c(3),f("ngModel",t.nuevoProducto.nombre),c(3),f("ngModel",t.nuevoProducto.descripcion),c(3),f("ngModel",t.nuevoProducto.precio),c(3),f("ngModel",t.nuevoProducto.stock),c(4),p("ngIf",t.nuevoProducto.imagen)}}var X,lt=Y(()=>{V();A();Q();Z();V();A();Q();X=class d{modalActivo=!1;editandoId=null;categoriasDisponibles=["plantas","macetas","sustratos","cuidados","paquetes"];categoriasSeleccionadas=[];nuevoProducto=this.obtenerProductoVacio();productos=[];productosFiltrados=[];cargando=!1;productoService=E(z);cdr=E(I);ngOnInit(){this.cargarProductos()}cargarProductos(){this.cargando=!0,this.productoService.obtenerProductos().subscribe({next:n=>{this.productos=n.map(t=>y(v({},t),{cantidadExtra:0})),this.filtrarProductos(),this.cargando=!1,this.cdr.detectChanges()},error:n=>{console.error("\u274C Error al obtener productos:",n),alert("\u26A0\uFE0F No se pudieron cargar los productos. Verifica Firestore."),this.cargando=!1}})}filtrarProductos(){this.categoriasSeleccionadas.length===0?this.productosFiltrados=this.productos:this.productosFiltrados=this.productos.filter(n=>this.categoriasSeleccionadas.includes(this.normalizarTexto(n.categoria)))}toggleCategoria(n){let t=this.categoriasSeleccionadas.indexOf(n);t===-1?this.categoriasSeleccionadas.push(n):this.categoriasSeleccionadas.splice(t,1),this.filtrarProductos()}abrirModal(n){this.modalActivo=!0,n?(this.editandoId=n.id,this.nuevoProducto=v({},n)):(this.editandoId=null,this.nuevoProducto=this.obtenerProductoVacio())}cerrarModal(){this.modalActivo=!1,this.editandoId=null,this.resetearFormulario()}guardarProducto(){return M(this,null,function*(){if(this.nuevoProducto.categoria=this.normalizarTexto(this.nuevoProducto.categoria),this.nuevoProducto.nombre.trim()&&this.nuevoProducto.imagen&&this.nuevoProducto.categoria&&this.nuevoProducto.precio>=0&&this.nuevoProducto.stock>=0)try{this.editandoId?(yield this.productoService.actualizarProducto(this.editandoId,this.nuevoProducto),alert("\u2705 Producto actualizado correctamente.")):(yield this.productoService.agregarProducto(this.nuevoProducto),alert("\u2705 Producto agregado correctamente.")),this.cerrarModal(),this.refrescarDatos()}catch(n){console.error("\u274C Error al guardar producto:",n),alert("\u26A0\uFE0F Error al guardar el producto.")}else alert("\u26A0\uFE0F Completa todos los campos requeridos.")})}cargarImagen(n){let t=n.target.files[0];if(t){let l=new FileReader;l.onload=()=>{this.nuevoProducto.imagen=l.result},l.readAsDataURL(t)}}inhabilitar(n){this.productoService.actualizarProducto(n.id,{estado:"inactivo"}).then(()=>{console.log(`\u2705 Producto ${n.nombre} inhabilitado.`),this.refrescarDatos()}).catch(t=>{console.error("\u274C Error al inhabilitar producto:",t),alert("\u26A0\uFE0F No se pudo inhabilitar el producto.")})}activar(n){this.productoService.actualizarProducto(n.id,{estado:"activo"}).then(()=>{console.log(`\u2705 Producto ${n.nombre} activado.`),this.refrescarDatos()}).catch(t=>{console.error("\u274C Error al activar producto:",t),alert("\u26A0\uFE0F No se pudo activar el producto.")})}aumentarStock(n){return M(this,null,function*(){if(n.cantidadExtra>0)try{yield this.productoService.aumentarStockProducto(n.id,n.cantidadExtra),alert(`\u2705 Se han a\xF1adido ${n.cantidadExtra} unidades al stock.`),n.cantidadExtra=0,this.refrescarDatos()}catch(t){console.error("\u274C Error al aumentar stock:",t),alert("\u26A0\uFE0F No se pudo aumentar el stock.")}else alert("\u26A0\uFE0F Ingresa una cantidad v\xE1lida para aumentar stock.")})}refrescarDatos(){this.cargarProductos()}resetearFormulario(){this.nuevoProducto=this.obtenerProductoVacio()}obtenerProductoVacio(){return{nombre:"",descripcion:"",imagen:"",precio:0,stock:0,categoria:"",estado:"activo"}}normalizarTexto(n){return n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}static \u0275fac=function(t){return new(t||d)};static \u0275cmp=k({type:d,selectors:[["app-productos"]],decls:14,vars:5,consts:[[1,"productos-panel"],[1,"filtros-categorias"],["class","chip",4,"ngFor","ngForOf"],[1,"acciones-productos"],[1,"btn-crear",3,"click"],["class","cargando",4,"ngIf"],["class","sin-productos",4,"ngIf"],["class","tabla-productos",4,"ngIf"],["class","modal-bg",4,"ngIf"],[1,"chip"],["type","checkbox",3,"change","checked"],[1,"cargando"],[1,"sin-productos"],[1,"tabla-productos"],[4,"ngFor","ngForOf"],[1,"actualizar-stock"],["type","number","min","1","placeholder","\u2795 A\xF1adir",2,"width","70px","margin-right","4px",3,"ngModelChange","ngModel"],["title","A\xF1adir al stock",1,"btn-actualizar-stock",3,"click"],["alt","Imagen",1,"miniatura",3,"src"],["title","Editar",1,"btn-editar",3,"click"],["class","btn-inactivar","title","Inhabilitar",3,"click",4,"ngIf"],["class","btn-activar","title","Activar",3,"click",4,"ngIf"],["title","Inhabilitar",1,"btn-inactivar",3,"click"],["title","Activar",1,"btn-activar",3,"click"],[1,"modal-bg"],[1,"modal"],["for","categoria"],["id","categoria","required","",3,"ngModelChange","ngModel"],["disabled","","value",""],[3,"value",4,"ngFor","ngForOf"],["for","nombre"],["id","nombre","type","text","required","",3,"ngModelChange","ngModel"],["for","descripcion"],["id","descripcion",3,"ngModelChange","ngModel"],["for","precio"],["id","precio","type","number","min","0","required","",3,"ngModelChange","ngModel"],["for","stock"],["id","stock","type","number","min","0","placeholder","Cantidad inicial","required","",3,"ngModelChange","ngModel"],["for","imagen"],["type","file","accept","image/*",3,"change"],["class","imagen-preview",4,"ngIf"],[1,"acciones-modal"],[1,"btn-guardar",3,"click"],[1,"btn-cancelar",3,"click"],[3,"value"],[1,"imagen-preview"],["alt","Vista previa",3,"src"]],template:function(t,l){t&1&&(o(0,"section",0)(1,"h2"),r(2,"\u{1F6D2} Gesti\xF3n de Productos"),e(),o(3,"div",1)(4,"span"),r(5,"\u{1F4C2} Filtrar por categor\xEDa:"),e(),_(6,$,4,4,"label",2),e(),o(7,"div",3)(8,"button",4),g("click",function(){return l.abrirModal()}),r(9,"\u2795 Nuevo Producto"),e()(),_(10,tt,2,0,"div",5)(11,et,2,0,"div",6)(12,rt,21,1,"table",7),e(),_(13,dt,31,8,"div",8)),t&2&&(c(6),p("ngForOf",l.categoriasDisponibles),c(4),p("ngIf",l.cargando),c(),p("ngIf",!l.cargando&&l.productosFiltrados.length===0),c(),p("ngIf",!l.cargando&&l.productosFiltrados.length>0),c(),p("ngIf",l.modalActivo))},dependencies:[W,F,T,N,K,U,G,B,j,R,L,J,H,q],styles:[".productos-panel[_ngcontent-%COMP%]{padding:2rem;background-color:#f5f7fa}.productos-panel[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;margin-bottom:1rem;color:#2c3e50}.acciones-productos[_ngcontent-%COMP%]{margin-bottom:1rem;text-align:right}.btn-crear[_ngcontent-%COMP%]{background-color:#2ecc71;color:#fff;border:none;padding:.6rem 1.2rem;border-radius:6px;cursor:pointer}.btn-crear[_ngcontent-%COMP%]:hover{background-color:#27ae60}.filtros-categorias[_ngcontent-%COMP%]{margin-bottom:1rem;display:flex;flex-wrap:wrap;align-items:center;gap:.5rem}.filtros-categorias[_ngcontent-%COMP%]   .chip[_ngcontent-%COMP%]{display:flex;align-items:center;background:#ecf0f1;border-radius:20px;padding:.3rem .8rem;cursor:pointer;transition:background .3s ease}.filtros-categorias[_ngcontent-%COMP%]   .chip[_ngcontent-%COMP%]:hover{background:#d0d7de}.filtros-categorias[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-right:.4rem}.tabla-productos[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:#fff;box-shadow:0 2px 6px #0000001a}.tabla-productos[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabla-productos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.8rem;text-align:center;border-bottom:1px solid #ddd}.tabla-productos[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.tabla-productos[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   img.miniatura[_ngcontent-%COMP%]{width:50px;height:50px;object-fit:cover;border-radius:4px}.btn-editar[_ngcontent-%COMP%], .btn-inactivar[_ngcontent-%COMP%], .btn-activar[_ngcontent-%COMP%]{border:none;padding:.3rem .6rem;margin:0 .1rem;border-radius:4px;cursor:pointer}.btn-editar[_ngcontent-%COMP%]{background-color:#f1c40f}.btn-editar[_ngcontent-%COMP%]:hover{background-color:#d4ac0d}.btn-inactivar[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff}.btn-inactivar[_ngcontent-%COMP%]:hover{background-color:#c0392b}.btn-activar[_ngcontent-%COMP%]{background-color:#2ecc71;color:#fff}.btn-activar[_ngcontent-%COMP%]:hover{background-color:#27ae60}.modal-bg[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center}.modal[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:8px;width:90%;max-width:500px}.modal[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem;color:#2c3e50}.modal[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-top:.8rem;font-weight:500}.modal[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .modal[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .modal[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:.6rem;margin-top:.3rem;border:1px solid #ccc;border-radius:4px}.imagen-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:auto;margin-top:.8rem}.acciones-modal[_ngcontent-%COMP%]{margin-top:1rem;display:flex;justify-content:flex-end;gap:.8rem}.btn-guardar[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;border:none;padding:.5rem 1rem;border-radius:4px;cursor:pointer}.btn-guardar[_ngcontent-%COMP%]:hover{background-color:#2980b9}.btn-cancelar[_ngcontent-%COMP%]{background-color:#bdc3c7;color:#2c3e50;border:none;padding:.5rem 1rem;border-radius:4px;cursor:pointer}.btn-cancelar[_ngcontent-%COMP%]:hover{background-color:#95a5a6}"]})}});lt();export{X as ProductosComponent};
