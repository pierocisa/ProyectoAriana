<div class="admin-container">
  <h2>ğŸ“¦ GestiÃ³n de Pedidos</h2>
  <table class="admin-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Cliente</th>
        <th>TelÃ©fono</th>
        <th>DirecciÃ³n</th>
        <th>Codigo Pago</th> <!-- ğŸ†• NUEVO -->
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let pedido of pedidos">
        <td>{{ pedido.id }}</td>
        <td>{{ pedido.cliente.nombre }} {{ pedido.cliente.apellido }}</td>
        <td>{{ pedido.telefono }}</td>
        <td>{{ pedido.direccion }}</td>
        <td>{{ pedido.codigoPago }}</td> <!-- ğŸ†• Mostrar cÃ³digo pago -->
        <td>{{ pedido.estado | uppercase }}</td>
        <td>
          <button (click)="verDetalles(pedido)">ğŸ‘ï¸ Ver</button>
          <button (click)="abrirModal(pedido)">âœï¸ Editar</button>
          <button (click)="eliminarPedido(pedido.id)">ğŸ—‘ï¸</button>

          <!-- ğŸ†• BotÃ³n Validar solo si el estado es PENDIENTE -->
          <button
            class="btn-validar"
            (click)="validarPedido(pedido.id)"
            *ngIf="pedido.estado === 'PENDIENTE'">
            âœ… Validar
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Modal compartido -->
<div class="modal-bg" *ngIf="modalActivo">
  <div class="modal">
    <h2>{{ modoLectura ? 'ğŸ‘ï¸ Detalles del Pedido' : 'âœï¸ Editar Estado del Pedido' }}</h2>

    <div class="info-cliente">
      <p><strong>Cliente:</strong> {{ pedidoEditando.cliente.nombre }} {{ pedidoEditando.cliente.apellido }}</p>
      <p><strong>TelÃ©fono:</strong> {{ pedidoEditando.telefono }}</p>
      <p><strong>DirecciÃ³n:</strong> {{ pedidoEditando.direccion }}</p>
      <p><strong>CÃ³digo de Pago:</strong> {{ pedidoEditando.codigoPago }}</p> <!-- ğŸ†• Mostrar cÃ³digo en modal -->
    </div>

    <div class="campo-form">
      <label for="estado">ğŸ› ï¸ Estado del Pedido</label>

      <ng-container *ngIf="modoLectura; else editarEstado">
        <p style="margin-top: 0.5rem; font-weight: bold;">{{ pedidoEditando.estado | uppercase }}</p>
      </ng-container>

      <ng-template #editarEstado>
        <select id="estado" [(ngModel)]="pedidoEditando.estado">
          <option value="pendiente">â³ Pendiente</option>
          <option value="enviado">âœ… Enviado</option>
          <option value="cancelado">âŒ Cancelado</option>
        </select>
      </ng-template>
    </div>

    <div class="acciones-modal">
      <button *ngIf="!modoLectura" class="btn-guardar" (click)="guardarCambiosPedido()">ğŸ’¾ Guardar Cambios</button>
      <button class="btn-cancelar" (click)="cerrarModal()">Cerrar</button>
    </div>
  </div>
</div>
